---
import { Icon } from 'astro-icon/components';
import clsx from 'clsx';

import config from '@/config';

const pathname = Astro.url.pathname;
---

<div class="md:hidden" x-data="{ open: false }" x-init="$watch('open', value => document.body.style.overflow = value ? 'hidden' : 'auto')">
  <button
    aria-label="Mobile Menu"
    title="Mobile Menu"
    type="button"
    class="relative z-[60] flex items-center p-2 base-button-hover base-button-animation"
    @click="open = !open"
  >
    <div class="relative h-6 w-6">
      <Icon
        name="hugeicons:cancel-01"
        size={24}
        class="absolute inset-0 transition-all duration-300"
        :class="{ 'opacity-100 scale-100 rotate-0': open, 'opacity-0 scale-50 rotate-90': !open }"
      />
      <Icon 
        name="hugeicons:menu-02" 
        size={24} 
        class="absolute inset-0 transition-all duration-300"
        :class="{ 'opacity-0 scale-50 rotate-90': open, 'opacity-100 scale-100 rotate-0': !open }"
      />
    </div>
  </button>

  <div
    x-show="open"
    x-transition:enter="transition ease-out duration-500"
    x-transition:enter-start="opacity-0 -translate-y-full"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-500"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-full"
    x-cloak
    class="fixed inset-0 z-50 flex flex-col bg-neutral-100/90 p-6 backdrop-blur-xl dark:bg-neutral-900/90"
  >
    <div class="flex flex-col items-center justify-center h-full space-y-8">
      {
        config.headbar.routes.map((item, index) => (
          <a 
            href={item.href}
            @click="open = false"
            class={clsx(
              "text-4xl font-bold tracking-tight transition-all duration-500 hover:scale-110 active:scale-95",
              (pathname === "/"
                ? pathname === item.href
                : pathname.startsWith(item.href ?? "") &&
                  item.href !== "/") 
                ? "text-orange-600 dark:text-orange-500"
                : "text-neutral-800 dark:text-neutral-200"
            )}
            :class="{ 'opacity-100 translate-y-0': open, 'opacity-0 translate-y-8': !open }"
            style={`transition-delay: ${150 + index * 50}ms`}
          >
            {item.name}
          </a>
        ))
      }
    </div>
  </div>
</div>
